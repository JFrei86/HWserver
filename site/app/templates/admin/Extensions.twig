<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

<div type="hidden" id="message"></div>
<div class="content">
    <h1>Excused Absence Extensions</h1>
    <form id="extensions-form" class="exception-form" method="post" enctype="multipart/form-data" action="">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
        <input type="hidden" name="option" value="-1" />
        <div class="option">
            <p>Use this form to grant an extension (e.g., for an excused absence) to a user on a specific assignment.</p>
            <div class="option">
                <label for="g_id">Select Gradeable:</label>
                <select name="g_id" id="gradeable-select" onchange="updateGradeableForExtensions()">
                    <option disabled {% if current_gid is null %} selected {% endif %} value> -- select an option -- </option>
                    {% for index, value in gradeables %}
                        <option 
                            value="{{value['g_id']}}" 
                            {% if current_gid == value['g_id'] %} 
                                selected 
                                {% set due_date = value['eg_submission_due_date'] %}
                                {% set current_gradeable = value['g_title'] %}
                            {% endif %} 
                        >
                            {{ value['g_title'] }} : {{ value['eg_submission_due_date'] }}
                        </option>
                    {% endfor %}
                </select>
                {% if current_gid is not null %}
                    <p id ="due-date">Set Due Date: {{ due_date|date("m/d/Y H:i:s") }}</p>
                {% endif %}
            </div>
        </div>
        <fieldset class="single-student">
            <legend class="option-title">Single Student Entry</legend>
            <label for="user_id">
                Student ID:
                <input name="user_id" id="user_id" class="option-input" type="text">
            </label>
            <label for="late_days">
                Give the Days of Extension:
                <input name="late_days" id="late-days" class="option-input" type="text" onkeyup="clearDate()">
            </label>
            <label for="late_calendar">
                Or Pick a New Due Date:
                <input name="late_calendar" id="late-calendar" class="option-input" type="text" onchange="clearLateDays()">
            </label>
            <a class="btn btn-primary" href="javascript:updateHomeworkExtension()">Submit</a>
        </fieldset>
        <fieldset>
            <legend class="option-title">Multiple Student Entry Via CSV Upload</legend>
            <label for="csv_upload">
                Do not use column headers. CSV must be of the following form: student_id, gradeable_id, days_of_extension
            </label>
            <input type="file" name="csv_upload" aria-labelledby="csv_upload_title csv_upload_format" onchange="updateHomeworkExtension()">
        </fieldset>
    </form>
    {% if current_exceptions is null %}
        <p id="empty-table" class="warning">
            {% if current_gid is null %}
                No gradeable has been selected
            {% else %}
                No extensions are currently entered for this gradeable
            {% endif %}
        </p>
    {% else %}
        {# This is a data table #}
        <table id="extensions-table" class="table table-striped mobile-table">
            <caption>Extensions</caption>
            <thead>
                <th>Student ID</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Number of Days of Extension</th>
                <th>Delete</th>
            </thead>
            <tbody>
                {% for user in current_exceptions %}
                    <tr>
                        <td class="align-left">{{ user.user_id }}</td>
                        <td class="align-left">{{ user.user_firstname }}</td>
                        <td class="align-left">{{ user.user_lastname }}</td>
                        <td>{{ user.late_day_exceptions }}</td>
                        <td>
                            <a 
                                aria-label="Delete {{ user.getId() }}'s extension for {{ current_gradeable }}" 
                                href="javascript:deleteHomeworkExtension('{{ user.user_id }}');"
                            >
                                <i class="fas fa-trash"></i>
                            </a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
</div>
<script>
    $("#user_id").autocomplete({
        source: {{ student_full|raw }}
    });
</script>
{% include('admin/users/MoreExtensions.twig') %}
