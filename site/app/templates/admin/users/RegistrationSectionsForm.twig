{% import _self as self %} {# Required to use macros in same template #}
{# 
Macros
#}
{# Display the checkboxes for a given set of graders at a grader level #}
{% macro display_graders(graders, num_boxes) %}
    {% for grader in graders %}
        <tr>
            <th>{{ grader.getDisplayedFirstName() ~ " " ~ grader.getDisplayedLastName() ~ "(" ~ grader.getId() ~ ")" }}</th>
            <td><input type="checkbox" name="{{ grader.getId() }}_all" id="{{ grader.getId() }}_all" 
				onclick="updateCheckBoxes('{{ grader.getId() }}', true);" /></td>
            {% for rs in 1..num_boxes %}
                <td><input type="checkbox" name="{{ grader.getId() }}_{{rs}}" id="{{ grader.getId() }}_{{rs}}" 
				onclick="updateCheckBoxes('{{ grader.getId() }}', false);"/></td>
            {% endfor %}
        </tr>
    {% endfor %}

{% endmacro %}

{% extends 'generic/Popup.twig' %}
{% block popup_id %}registration-sections-form{% endblock %}
{% block title %}Edit Registration Sections for Graders{% endblock %}
{% block body %}

{% if graders[1]|length + graders[2]|length + graders[3]|length > 0 %}
	<table id="registration_section_assignment">
		{% if reg_sections|length > 0 %}
			<tr>
				<th />
				<th>All</th>
				{% for rs in 1..reg_sections|length %}
					<th>{{ rs }}</th>
				{% endfor %}
			</tr>
			<tr>
				<th>Instructor Graders</th>
			</tr>
			{{ self.display_graders(graders[1], reg_sections|length) }}
			<tr>
				<th>Full Access Graders</th>
			</tr>
			{{ self.display_graders(graders[2], reg_sections|length) }}
			<tr>
				<th>Limited Access Graders</th>
			</tr>
			{{ self.display_graders(graders[3], reg_sections|length) }}
		{% elseif num_rotating_sections == 0 %}
			<br/>
			<p><b>Rotating Sections have not been set up yet. <br/> You can set up Rotating Sections using the "Manage Sections" option on the sidebar.</b></p>
		{% endif %}
	</table>
{% else %}
	No graders found
{% endif %}
	
{% endblock %}
{% block form %}
    <form method="post" action="{{ return_url_update_grader }}">
        {{ parent() }}
    </form>
{% endblock %}
{% block buttons %}
    {{ block('close_button') }}
    <input class="btn btn-primary" type="submit" value="Submit" />
{% endblock %}
{% block js %}
<script>

    function updateCheckBoxes(grader_id,all_box) {	
        if(all_box) {
            //update all check boxes for that user with the "all" box state
            var value = $('#' + {{grader_id}} + '_all').is(':checked');
            {% for rs in section_numbers %}
                $('#' + {{grader_id}} + '_' + {{rs}}).prop('checked', value);
            {% endfor %}
        }
        else { // if all boxes are checked, then check the 'all' box
            var all_checked = true
            {% for rs in 1..num_boxes %}
                && $('#' + {{grader_id}} + '_' + {{rs}}).is(':checked')
            {% endfor %}
            ;
			
            $('#' + {{grader_id}} + '_all').prop('checked', all_checked);
        }
    }

    $(document).ready(function() {
        // update "all" check boxes
        {% for grader in graders_from_usertypes[1] %}
        //updateCheckBoxes({{grader.getId()}}, false);
		{% endfor %}
    });

</script>
{% endblock %}