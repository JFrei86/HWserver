<div class="content">
    <h1>Plagiarism Detection Configuration -- WORK IN PROGRESS</h1>
    <br>
    <div id="save-configuration-form" style="overflow:auto;">
        <form method="post" action="{$this->core->buildCourseUrl(['plagiarism', 'configuration', 'new'])}?new_or_edit={$new_or_edit}&gradeable_id={$gradeable_id}" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{$this->core->getCsrfToken()}" />
            <input type="hidden" name="prior_term_gradeables_number" value="{$prior_term_gradeables_number}" />
            <input type="hidden" name="ignore_submission_number" value="{$ignore_submission_number}" /><br />
            <div style="width:100%;">
                <div style="width:20%;float:left">Select Gradeable:</div>
                <div style="width:70%;float:right">

                    {% if new_or_edit == "new" %}
                        <select name="gradeable_id">
                            {% for gradeable_id_title in gradeables_ids_titles %}
                                <option value="{{ gradeable_id_title['g_id'] }}">{{ gradeable_id_title['g_title'] }}</option>
                            {% endfor %}
                        </select>
                    {% else %}
                        {{ title }}
                    {% endif %}

                </div>
            </div><br /><br /><br /><br /><br />
            <div style="width:100%;">
                <div style="width:20%;float:left">Instructor Provided Code:</div>
                <div style="width:70%;float:right">
                    <input type="radio" id="no_code_provided_id" value="no_code_provided" name="provided_code_option" {$no_provided_code} >
                    <label for="no_code_provided_id">No</label>
                    <input type="radio" id="code_provided_id" value="code_provided" name="provided_code_option" {$provided_code}>
                    <label for="code_provided_id">Yes</label><br />
                    <input type="file" name="provided_code_file">

                    {% if new_or_edit == "edit" and saved_config['instructor_provided_code'] %}
                        <br />
                        <font size="-1">Current Provided Code: $provided_code_filename</font>
                    {% endif %}

                </div>
            </div><br /><br /><br /><br /><br />
            <div style="width:100%;">
                <div style="width:20%;float:left">Version:</div>
                <div style="width:70%;float:right">
                    <input type="radio" id="all_version_id" value="all_version" name="version_option" {$all_version} >
                    <label for="all_version_id">All Version</label>
                    <input type="radio" id="active_version_id" value="active_version" name="version_option" {$active_version}>
                    <label for="active_version_id">Only Active Version</label><br />
                </div>
            </div><br /><br /><br /><br /><br />
            <div style="width:100%;">
                <div style="width:20%;float:left">Files to be Compared:</div>
                <div style="width:70%;float:right">
                    <input type="radio" id="all_files_id" value="all_files" name="file_option" {$all_files}>
                    <label for="all_files_id">All Files</label>
                    <input type="radio" id="regex_matching_files_id" value="regex_matching_files" name="file_option" {$regex_matching_files}>
                    <label for="regex_matching_files_id">Regex matching files</label><br />
                    <input type="text" name="regex_to_select_files" value="{$regex}"/>
                </div>
            </div><br /><br /><br /><br /><br />
            <div style="width:100%;">
                <div style="width:20%;float:left">Language:</div>
                <div style="width:70%;float:right">
                    <select name="language">
                        <option value="python" {$language['python']}>Python</option>
                        <option value="cpp" {$language['cpp']}>C++</option>
                        <option value="java" {$language['java']}>Java</option>
                        <option value="plaintext" {$language['plaintext']}>Plain Text</option>
                        <option value="mips" {$language['mips']}>MIPS Assembly</option>
                    </select>
                </div>
            </div><br /><br /><br /><br /><br />
            <div style="width:100%;">
                <div style="width:20%;float:left">Threshold/Maximum number of students<br>(more than this number of students with matching code will be considered common code):</div>
                <div style="width:70%;float:right">
                    <input type="text" name="threshold"/ value="{$threshold}" />
                </div>
            </div><br /><br /><br /><br /><br />
            <div style="width:100%;">
                <div style="width:20%;float:left">Sequence Length:</div>
                <div style="width:70%;float:right">
                    <input type="text" name="sequence_length" value="{$sequence_length}"/>
                </div>
            </div><br /><br /><br /><br /><br />
            <div style="width:100%;overflow:auto;">
                <div style="width:20%;float:left">Prior Terms Gradeables:</div>
                <div style="width:70%;float:right;overflow:auto;" name= "prev_gradeable_div">

                    {% if new_or_edit == "edit" %}
                        {% for saved_prev_term_gradeable_path as saved_config['prev_term_gradeables'] %}
                            {% set reversed_per_term_grad_path = saved_prev_term_gradeable_path|reverse %}
                            {% set exploded_reversed_per_term = reversed_per_term_grad_path|split('/') %}
                            {% set saved_prev_sem = exploded_reversed_per_term[3]|reverse %};
                            {% set saved_prev_course = exploded_reversed_per_term[2]|reverse %};
                            {% set saved_prev_gradeable = exploded_reversed_per_term[0]|reverse %};

                            <select name="prev_sem_{{ loop.index0 }}">
                                <option value="">None</option>
                                {% for sem, sem_courses in prior_term_gradeables %}
                                    <option value="{{ sem }}"
                                            {% if sem == saved_prev_sem %}
                                                selected
                                            {% endif %}
                                    >
                                        {{ sem }}
                                    </option>
                                {% endfor %}
                            </select>
                            <select name="prev_course_{{ loop.index0 }}">
                                <option value="">None</option>
                                {% for sem_course, course_gradeables in prior_term_gradeables[saved_prev_sem] %}
                                    <option value="{{ sem_course }}"
                                            {% if sem_course == saved_prev_course %}
                                                selected
                                            {% endif %}
                                    >
                                        {{ sem_course }}
                                    </option>
                                {% endfor %}
                            </select>
                            <select name="prev_gradeable_{{ loop.index0 }}">
                                <option value="">None</option>
                                {% for course_gradeable in prior_term_gradeables[saved_prev_sem][saved_prev_course] %}
                                    <option value="{{ course_gradeable }}"
                                    {% if course_gradeable == saved_prev_gradeable %}
                                    selected
                                    {% endif %}
                                    >
                                        {{ course_gradeable }}
                                    </option>
                                {% endfor %}
                            </select>
                            <br />
                        {% endfor %}
                    {% endif %}
                    {% set saved_prev_term_grad_length = saved_config['prev_term_gradeables'].length %}
                    <select name="prev_sem_{{ saved_prev_term_grad_length }}">
                        <option value="">None</option>
                        {% for sem, sem_courses in prior_term_gradeables %}
                            <option value="{{ sem }}">{{ sem }}</option>
                        {% endfor %}
                    </select>

                    <select name="prev_course_{{ saved_prev_term_grad_length }}">
                        <option value="">None</option>
                    </select>
                    <select name="prev_gradeable_{{ saved_prev_term_grad_length }}">
                        <option value="">None</option>
                    </select>
                </div><br />
                <div style="width:70%;float:right">
                    <span name="add_more_prev_gradeable" aria-label="Add more">
                        <i class="fas fa-plus-square"></i>Add more
                    </span>
                </div>
            </div><br /><br /><br /><br /><br />
            <div style="width:100%;overflow:auto;">
                <div style="width:20%;float:left">Are there any submissions that should be ignored?</div>
                <div name="ignore_submission_div" style="width:70%;float:right;overflow:auto;">
                    <input type="radio" id="ignore_none_id" value="no_ignore" name="ignore_submission_option" {$no_ignore} >
                    <label for="ignore_none_id">No</label>
                    <input type="radio" id="ignore_id" value="ignore" name="ignore_submission_option" {$ignore} >
                    <label for="ignore_id">Yes</label><br />

                    {% if new_or_edit == "edit" %}
                        {% for saved_ignore_submission in ignore_submissions %}
                            <input type="text" name="ignore_submission_{{ loop.index0 }}" value="{{ saved_ignore_submission }}"/><br />
                        {% endfor %}
                    {% endif %}
                    <input type="text" name="ignore_submission_{{ ignore_submissions.length }}" />
                </div>
                <br />
                <div style="width:70%;float:right">
                    <span name="add_more_ignore" aria-label="Add more">
                        <i class="fas fa-plus-square"></i>Add more
                    </span>
                </div>
            </div><br /><br />
            <div style="float: right; width: auto; margin-top: 5px;">
                <a href="{$this->core->buildCourseUrl(['plagiarism'])}" class="btn btn-danger">Cancel</a>
                <input class="btn btn-primary" type="submit" value="Save Configuration" />
            </div><br /><br /><br />
        </form>
    </div>
</div>

<script>
    const form = $("#save-configuration-form");
    const prior_term_gradeables = JSON.parse('{$prior_term_gradeables_json}');
    $("select").change(function(){
        var select_element_name = $(this).attr("name");
        configureNewGradeableForPlagiarismFormOptionChanged(prior_term_gradeables, select_element_name);
    });
    $('[name="add_more_prev_gradeable"]', form).on('click', function(){
        addMorePriorTermGradeable(prior_term_gradeables);
    });
    $('[name="add_more_ignore"]', form).on('click', function(){
        const ignore_submission_number = $('[name="ignore_submission_number"]', form).val();
        $('[name="ignore_submission_div"]', form).append('<br /><input type="text" name="ignore_submission_'+ ignore_submission_number +'" />');
        $('[name="ignore_submission_number"]', form).val(parseInt(ignore_submission_number)+1);
    });
</script>
