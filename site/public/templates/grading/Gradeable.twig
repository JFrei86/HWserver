<div id="gradeable-rubric" class="gradeable" data-gradeable_id="{{ gradeable.id }}">
    {% block header_content %}
    {% endblock %}
{# Components #}
    {# twig.js doens't support blocks inside of for loops ... ANNOYING #}
    <div id="component-list">
        {% block components_block %}
        {% endblock %}
    </div>
{# /Components #}

    {% block footer_content %}
    {% endblock %}
</div>

<script type="text/javascript">
    //
    // This is needed to resolve conflicts between Chrome and other browsers
    //   where Chrome can only do synchronous ajax calls on 'onbeforeunload'
    //   and other browsers can only do synchronous ajax calls on 'onunload'
    //
    // Reference:
    //    https://stackoverflow.com/questions/4945932/window-onbeforeunload-ajax-request-in-chrome
    //
    var __unloadRequestSent = false;
    var __unloadRequestComplete = false;
    function unloadSave() {
        if (!__unloadRequestSent) {
            if (getOpenComponentIds().length > 0) {
                __unloadRequestSent = true;
                __unloadRequestComplete = false;
                AJAX_USE_ASYNC = false;
                closeAllComponents(true)
                    .then(function() {
                        __unloadRequestComplete = true;
                    })
                    .catch(function () {})
                    .then(function () {
                        // Unable to save so try saving at a different time
                        __unloadRequestSent = false;
                    });
                return __unloadRequestComplete ? null : "Your changes may not be saved.  Close all open Components";
            }
        }
    }
    // Will work for Chrome
    window.onbeforeunload = unloadSave;
    // Will work for other browsers
    window.onunload = unloadSave;
</script>
