{% extends "Component.twig" %}
{% import "Functions.twig" as functions %}
{#
Required inputs:
    precision
    component: {id, title, ta_comment, student_comment, page, max_value}
    graded_component: {grader_id, verifier_id, submitter_id, comment, score, mark_ids, graded_version, total_score}

    show_verify_grader = can_verify and grader_id is defined and grader_id != your_user_id
    grading_disabled = version_conflict = graded_component.graded_version != -1 and graded_gradeable.auto_graded_gradeable.active_version != graded_component.graded_version

     {{ functions.getBadgeStyle(graded_component.total_score, component.max_value) }}
#}

{% set show_verify_grader = can_verify_graders and grader_id != graded_component.grader_id %}

{% block component_click %}
    {{ grading_disabled ? '' : 'onClickComponent(this)' }}
{% endblock %}

{% block left_block %}
    {# Note: the ternery operator cannot consistently be used to insert the result of a macro into the output,
        so we need to use the long-form {% if <condition> %}{{ call_macro() }}{% endif %} #}
    <strong id="grading_total"
            class="badge {% if graded_component is defined %} {{ functions.getBadgeStyle(graded_component.total_score, component.max_value) }} {% endif %}">
        {{ graded_component.total_score is defined ? graded_component.total_score|round(decimal_precision) : '-' }} / {{ component.max_value|round(decimal_precision) }}
    </strong>
{% endblock %}

{% block title_block %}
    <span class="graded-component-data"
          data-total_score="{{ graded_component.total_score }}"
          data-graded_version="{{ graded_component.graded_version | default('0') }}"
          data-grade_time="{{ graded_component.grade_time }}"
          data-grader_id="{{ graded_component.grader_id }}"
          data-verifier_id="" hidden></span>

    <span class="component-title col-no-gutters">
        <b>{{ component.title }}</b>
    </span>

    {% if component.page > 0 %}
        <span class="page-number-view col-no-gutters">
            <i>(Page #: {{ component.page }})</i>
        </span>
    {% endif %}

    <span class="divider col"> </span>

    {% if disabled %}
        <span class="version-warning col-no-gutters">
            Please edit or ensure that comments from version {{ graded_component.graded_version }} still apply.
        </span>
    {% endif %}

    {% if show_verify_grader %}
        <span class="verify-container col-no-gutters">
            <input type="button" class="btn btn-default" onclick="onVerifyComponent(this); event.stopPropagation()" value="Verify Grader"/>
        </span>
    {% endif %}

    <span class="graded-by col-no-gutters">
        {% if graded_component.grader_id is defined %}
            Graded by {{ graded_component.grader_id }}
            {% if graded_component.verifier_id is defined %}
                / {{ graded_component.verifier_id }}
            {% endif %}
        {% else %}
            Ungraded!
        {% endif %}
    </span>
{% endblock %}

{% block ta_comment_block %}
    {% if component.ta_comment != "" %}
        <span class="ta-student-comment">
            <i><b>Note to TA: </b>{{ component.ta_comment }}</i>
        </span>
    {% endif %}
{% endblock %}

{% block student_comment_block %}
    {% if component.student_comment != "" %}
        <span class="ta-student-comment">
            <i><b>Note to Student: </b>{{ component.student_comment }}</i>
        </span>
    {% endif %}
{% endblock %}

{% block marks_block %}
    {% for mark in component.marks %}
        {% set first_mark = loop.index0 == 0 %}
        {% set is_checked = mark.id in graded_component.mark_ids %}
        {% set mark_disabled = first_mark and not is_checked and (graded_component.mark_ids|length > 0 or graded_component.custom_mark_selected) %}
        {% include "Mark.twig" %}
    {% endfor %}
{% endblock %}

{% block extra_mark_rows %}
    {# Custom mark (only display in non-edit mode #}
    {% if not edit_marks_enabled %}
        <div class="custom-mark-container mark-container row"
             data-mark_id="0">
            <span class="mark-selector-container">
                <span class="{{ graded_component.custom_mark_selected ? "mark-selected" : "" }} mark-selector col-no-gutters"
                      data-mark_id="0"
                      onclick="onToggleCustomMark(this)">
                </span>
            </span>
            <span class="col-no-gutters mark-points">
                <input type="number"
                       step="{{ precision }}"
                       onchange="onCustomMarkChange(this)"
                       value="{{ graded_component.score | default('0')}}">
            </span>
            <span class="col-sm mark-title">
                Custom:
                <textarea onchange="onCustomMarkChange(this)"
                          rows="1"
                          placeholder="Custom message for student..."
                          class="mark-note-custom"
                >{{ graded_component.comment }}</textarea>
            </span>
        </div>
    {% else %}
        <div class="custom-mark-data"
             data-selected="{{ graded_component.custom_mark_selected }}"
             data-score="{{ graded_component.score }}"
             data-comment="{{ graded_component.comment }}"
             hidden></div>
    {% endif %}
    {# /Custom mark #}
{% endblock %}
